<!DOCTYPE html>
<html lang="zh">
<head>
<!-- head--->
    
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"/>
    <meta charset="UTF-8">
	<meta name="keywords" content="IT,Linux,Docker,K8S,网络, Java, Python, XHTML, JavaScript">
	<meta name="keywords" content="IT民工,IT Worker">
	<meta name="description" content="IT技术分享">
    <!-- libs css-->
    <link rel="stylesheet" href="/_assets/css/bootstrap.css">
    <link rel="stylesheet" href="/_assets/css/tool.css">
    <!-- libs js -->
    <script src="/_assets/js/jquery-1.8.2.min.js"></script>
    <script src="/_assets/js/jquery.ba-hashchange.js"></script>
    <!--<script src="/_assets/js/onePage.js"></script>-->
    <script src="/_assets/js/tool.js"></script>
    <script src="/_assets/js/base.js"></script>
    <!-- style -->
    <link rel="stylesheet" href="/_assets/style.css">
    <link rel="stylesheet" href="/_assets/css/media.css">
	<meta name="keywords" content="解决使用Cloudflare加速vercel“您的连接不是私密连接”问题解决">
    <title>解决使用Cloudflare加速vercel“您的连接不是私密连接”问题解决-IT民工</title>
</head>
<body>
<!-- 头部 -->
<div class="header">
    <div class="container header-all phone">
        <div class="logo"><a href="/index.html"><img src="/_assets/images/logo.png"/></a></div>
        <div class="phone-show" id="phone-show">
            <div></div>
            <div></div>
            <div></div>
        </div>
        <ul class="nav" id="header-nav">
		
		
		
          <li><a href="/index.html"><i class="iconfont">&#xe6cb;</i>首页</a></li>
        
		
          <li><a href="/archives.html"><i class="iconfont">&#xe690;</i>归档</a></li>
        
		
          <li><a href="/about.html"><i class="iconfont">&#xe69e;</i>关于</a></li>
        
		 
		
          <li><a href="/rss.xml"><i class="iconfont">&#xe6cb;</i>RSS</a></li>
          
	           
        </ul>
    </div>
</div>
<t></t>

<!-- 内容 -->
<div class="content container" data-content>
    <!-- 一级 -->
					
    <ul class="list row bj-white" id="list-1">
        <li class="title">
            <i class="iconfont c-hong">&#xe940;</i>热门推介<label>欢迎访问IT民工的网站！</label>
        </li>
        <div>
            <li class="cont-req">
                <a class="t1_pick"><img src="/_assets/images/header-img-1.jpg"/></a>
				
					<h3><a href="/article/011.docker-link.html" >011.docker --link容器互联</a></h3>

				
            </li>
            <li class="cont-req">
                <a class="t1_pick"><img src="/_assets/images/header-img-2.jpg"/></a>
				
					<h3><a href="/article/010.docker-save-export.html" >010.Docker save 和 export 命令的区别</a></h3>
				
            </li>
            <li class="cont-req">
                <a class="t1_pick"><img src="/_assets/images/header-img-3.jpg"/></a>
				
					<h3><a href="/article/00032.linux-prompt_command.html" >Linux 系统精粹：深入解析 PROMPT_COMMAND 环境变量及其实用技巧-CSDN博客</a></h3>
				
            </li>
            <li class="cont-req">
                <a class="t1_pick"><img src="/_assets/images/header-img-4.jpg"/></a>
				
					<h3><a href="/article/cloudflare-vercel.html" >解决使用Cloudflare加速vercel“您的连接不是私密连接”问题解决</a></h3>
				
				
            </li>
            <li class="cont-req">
                <a class="t1_pick"><img src="/_assets/images/header-img-5.jpg"/></a>
				
					<h3><a href="/article/009.dockerfile.html" >Dockerfile指令详解</a></h3>
				
				
            </li>
        </div>
    </ul>
    <!-- 二级 -->
    <div class="love2" >

        <div class="left">
            <!-- 文章主体 -->
            <div class="contents">
                <div class="title">解决使用Cloudflare加速vercel“您的连接不是私密连接”问题解决</div>
                <div class="title_t">时间：2024-03-01 12:44丨编辑：<a href="/index.html">IT民工</a></div>
                <div class="ner">
                  <h2 id="前言"><a title="前言" href="#%E5%89%8D%E8%A8%80"></a>前言</h2>
<p>近期在vercel建立了一个个人网站，因为vercel无法访问，于是决定使用cloudflare进行代理加速。</p>
<h2 id="如何配置"><a title="如何配置" href="#%E5%A6%82%E4%BD%95%E9%85%8D%E7%BD%AE"></a>如何配置</h2>
<p>根据vercel的官方文档，将cloudflare（以下简称CF）与vercel结合使用有两种方法。第一种无代理（仅限DNS）的方法不能避免我们上述提到的问题，所以使用第二种，但是文档本身可能不那么好理解，因此分享这篇日志提供参考。</p>
<h3 id="替换域名dns服务器"><a title="替换域名DNS服务器" href="#%E6%9B%BF%E6%8D%A2%E5%9F%9F%E5%90%8DDNS%E6%9C%8D%E5%8A%A1%E5%99%A8"></a>替换域名DNS服务器</h3>
<p>将域名添加到CF之后，需要在你的域名注册商处修改DNS服务器为CF提供的DNS，通常为<code>mia.ns.cloudflare.com</code>和<code>rick.ns.cloudflare.com</code>。以腾讯云为例，在Dnspod无法修改NS记录且修改也无效，需要登陆腾讯云控制台，在域名处点击管理，然后找到DNS服务器进行修改。</p>
<h3 id="解析到vercel"><a title="解析到vercel" href="#%E8%A7%A3%E6%9E%90%E5%88%B0vercel"></a>解析到vercel</h3>
<p>进入CF中域名控制台，点击上方DNS图标，添加记录，A记录或者CNAME记录解析到你部署在vercel的项目。但是这个时候vercel仍然会显示未正确配置，并且这个时候访问很有可能返回错误。因为当 vercel 构建项目时，构建过程的最后一步是颁发 SSL 证书。作为此步骤的一部分，vercel 向 <code>域名/.well-known/acme-challenge</code> 发出 HTTP 请求。如果此 HTTP 请求被重定向到 HTTPS，Vercel 将无法颁发 SSL 证书。<br />
根据文档我们来用命令进行验证（注意协议是http）：</p>
<p>curl <a title="http://example.com/.well-known/acme-challenge" href="http://example.com/.well-known/acme-challenge">http://example.com/.well-known/acme-challenge</a> -I</p>
<p>如果能通过域名访问vercel将会返回：</p>
<p>curl <a title="http://example.com/.well-known/acme-challenge" href="http://example.com/.well-known/acme-challenge">http://example.com/.well-known/acme-challenge</a> -I<br />
HTTP/1.1 404 Not Found</p>
<p>如果运行命令收到<code>3xx</code>重定向，那么CF会阻止访问此路由，且vercel会将域名标记为未配置。</p>
<p>curl <a title="http://example.com/.well-known/acme-challenge" href="http://example.com/.well-known/acme-challenge">http://example.com/.well-known/acme-challenge</a> -I<br />
HTTP/1.1 308 Moved Permanently</p>
<p><a title="https://cdn.hin.cool/pic/sc/cfcurl.jpg/sy" href="https://cdn.hin.cool/pic/sc/cfcurl.jpg/sy"><img src="/_resources/b9ae6842cf1546cbb49301783d9865a0.jpg" /></a></p>
<p>本机测试结果为301重定向</p>
<h2 id="配置cloudflare规则"><a title="配置cloudflare规则" href="#%E9%85%8D%E7%BD%AEcloudflare%E8%A7%84%E5%88%99"></a>配置cloudflare规则</h2>
<h3 id="创建屏蔽规则"><a title="创建屏蔽规则" href="#%E5%88%9B%E5%BB%BA%E5%B1%8F%E8%94%BD%E8%A7%84%E5%88%99"></a>创建屏蔽规则</h3>
<p>为防止上述请求被重定向，需要通过以下方式创建https 例外页面规则：</p>
<ol>
<li>
<p>在CF控制台的“规则”选项卡中选择“创建页面规则”；</p>
</li>
<li>
<p>在“如果 URL 匹配”文本字段中输入 <code>*example.com//.well-known/acme-challenge/*</code>；</p>
</li>
<li>
<p>从“选择设置”下拉列表中选择“SSL”，然后从“选择 SSL 设置”下拉列表中选择“关”；</p>
</li>
<li>
<p>点击“保存并部署”按钮。</p>
</li>
</ol>
<p>cloudflare规则设置</p>
<p><strong>说明：这个时候使用curl命令测试，不出意外返回应该就是<code>HTTP/1.1 404 Not Found</code>，那么你的域名便可正常访问。如果仍然是301重定向，尝试关闭CF中的始终使用HTTPS。</strong></p>
<p><strong>参考官方</strong><br />
<a title="https://vercel.com/docs/integrations/cloudflare#using-wildcard-domains-optional" href="https://vercel.com/docs/integrations/cloudflare#using-wildcard-domains-optional">vercel与cloudflare集成 https://vercel.com/docs/integrations/cloudflare#using-wildcard-domains-optional</a></p>

                </div>
				<div style="padding:15px;">
				   <a href="javascript:;">
						
							标签: 
									<span >cloudflare</span>
									
						</a>
				</div>
                <div class="label"> 转载请注明出处！--- IT民工 </div>
               
            </div>           
        </div>
	<!----侧边栏 --->
	        <div class="right" id="list-right">
            <!-- 关于我 -->
            <div class="thisMe">
                <div class="touPick">
				<img src="/_assets/images/aboutme.jpg" alt="图片走丢了" title="IT民工"></div>
				<ul>
                    <li><b style="font-size:20px;">IT民工</b></li>
                </ul>
				<br>
                <ul>
                    <li><a href="/index.html" style="text-decoration:none;" title="主页" class="iconfont">&#xe619;</a></li>
                    <li><a target="_blank" href="mailto:dliangliang@cock.li" title="联系我" style="text-decoration:none;" class="iconfont">&#xe667;</a></li>
                    <li><a href="/about.html" style="text-decoration:none;" title="关于我" class="iconfont">&#xe645;</a></li>
                </ul>
            </div>
            <!-- 建站史 -->
            <div class="ku">
                <div class="title">建站史</div>
                <div class="shus">
                    <div class="line"></div>
                    <div class="shus-cont">
                        <a>Joplin</a><br>
                        <a>MarkDown</a><br>
                        <a>Pages Publisher</a><br>
                        <a>GitHub Pages</a><br>
                        <a>Cloudflare Pages</a><br>
                        <a>Vercel Project</a><br>
                        <a href="javascript:;" class="href-all">查看全部</a>
                    </div>
                </div>
            </div>
   
            <!-- 标签云 -->
            <div class="labels" id="labels">
                <div class="title">标签云</div>
                <a>打工狗</a>
                <a>代码奴</a>
                <a>金融嗜好</a>
                <a>X瘾患者</a>
                <a>偶尔撸B</a>
                <a>精分患者</a>
                <a>软肋不少</a>
                <a>喜历史</a>
            </div>
            <!-- 友情链接 -->
            <div class="ku">
                <div class="title">左邻右舍</div>
                <div class="neighbor">
                    <a target="_blank" href="https://www.zhihu.com/people/economicsshare" title="知乎：巴甫洛夫的实验">知乎：巴甫洛夫的实验</a>
                    <a target="_blank" href="https://space.bilibili.com/18059632" title="B站：巴甫洛夫的实验">B站：巴甫洛夫的实验</a>
                    <a target="_blank" href="https://author.baidu.com/home?from=bjh_article&app_id=1790832269223398" title="百家号：巴甫洛夫的实验">百家号：巴甫洛夫的实验</a>                  
                    <a target="_blank" href="https://fintechworker.20160808.xyz" title="IT民工 On Cloudflare">IT民工&nbsp;On&nbsp;Cloudflare</a>                  
                    <a target="_blank" href="https://fintechworker.github.io" title="IT民工 On GitHub">IT民工&nbsp;On&nbsp;GitHub</a>                  
                    <a target="_blank" href="https://fintechworker-github-io.vercel.app" title="IT民工 On Vercel">IT民工&nbsp;On&nbsp;Vercel</a>                  
                
				</div>
            </div>
			 <!-- 建站史 -->
            <div class="ku" style="height:300px;">
                <div class="title">有点懒啊！</div>
                <div class="neighbor" >
他有点懒啊！
				</div>
            </div>
        </div>

    </div>
</div>
<!-- 底部 -->
<div class="footer">
    Design by <a href="#">IT民工</a>
    <br>&copy; <script> document.write(new Date().getFullYear()); </script> <a href="#">IT民工</a>
</div>

<!-- 侧边栏 -->

<div class="ce">
    <a class="ceL" href="#" title="返回顶部"><i class="iconfont top">&#xe65b;</i></a>
</div>


</body>
</html>
